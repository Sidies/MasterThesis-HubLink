import pytest
from sqa_system.core.data.models.knowledge import Knowledge
from sqa_system.core.data.models.subgraph import Subgraph
from sqa_system.core.data.models.triple import Triple
from sqa_system.knowledge_base.knowledge_graph.storage.utils.graph_path_filter import GraphPathFilter
from sqa_system.knowledge_base.knowledge_graph.storage.utils.path_builder import PathBuilder

@pytest.fixture
def subgraph():
    entity_1 = Knowledge(
        uid="entity_1",
        text="entity_1"
    )
    entity_2 = Knowledge(
        uid="entity_2",
        text="entity_2"
    )
    entity_3 = Knowledge(
        uid="entity_3",
        text="entity_3"
    )
    entity_4 = Knowledge(
        uid="entity_4",
        text="entity_4"
    )
    entity_5 = Knowledge(
        uid="entity_5",
        text="entity_5"
    )
    entity_6 = Knowledge(
        uid="entity_6",
        text="entity_6"
    )
    relation_1 = Triple(
        entity_subject=entity_1,
        entity_object=entity_2,
        predicate="author_of"
    )
    relation_2 = Triple(
        entity_subject=entity_2,
        entity_object=entity_3,
        predicate="published_in"
    )
    relation_3 = Triple(
        entity_subject=entity_3,
        entity_object=entity_4,
        predicate="edited_by"
    )
    relation_4 = Triple(
        entity_subject=entity_3,
        entity_object=entity_5,
        predicate="writes"
    )
    relation_5 = Triple(
        entity_subject=entity_6,
        entity_object=entity_1,
        predicate="is_author_of"
    )

    return Subgraph([relation_1, relation_2, relation_3, relation_4, relation_5])




def test_subraph_to_path_and_back():
    """Test whether the subgraph can be converted to paths and back."""
    
    subgraph = Subgraph(root=[Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='Year', entity_object=Knowledge(uid='L1272137', text='2023', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272122', text='Collaborative Scenario Builder', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='Aim', entity_object=Knowledge(uid='L1272112', text='provide such a co-design tool for the specific context of VR scenario development.', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR scenes used/developed', entity_object=Knowledge(uid='L1272103', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='research problem', entity_object=Knowledge(uid='R734620', text='What is the VR implementation in first responders training', knowledge_types=['Problem'])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734607', text='medical first responders', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272086', text='Virtual Simulation Training', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734616', text='co-design', knowledge_types=['External']), predicate='description', entity_object=Knowledge(uid='L1272085', text='approach to design attempting to actively involve all stakeholders', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734616', text='co-design', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734616', text='co-design', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1272084', text='https://www.wikidata.org/entity/Q16972712', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R725100', text='virtual reality', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='Has participant', entity_object=Knowledge(uid='R734611', text='medicians', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='has female participants', entity_object=Knowledge(uid='L1272068', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='First Responders` training', entity_object=Knowledge(uid='L1272055', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='First responders', entity_object=Knowledge(uid='R734607', text='medical first responders', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q40', text='Austria', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='# participants', entity_object=Knowledge(uid='L1272042', text='41', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734575', text='Collaborative Scenario Builder: A VR Co-Design Tool for Medical First Responders', knowledge_types=['Paper']), predicate='contribution', entity_object=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution'])), Triple(entity_subject=Knowledge(uid='R734575', text='Collaborative Scenario Builder: A VR Co-Design Tool for Medical First Responders', knowledge_types=['Paper']), predicate='url', entity_object=Knowledge(uid='L1271987', text='http://dx.doi.org/10.1145/3582515.3609553', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734575', text='Collaborative Scenario Builder: A VR Co-Design Tool for Medical First Responders', knowledge_types=['Paper']), predicate='venue', entity_object=Knowledge(uid='R734577', text='Proceedings of the 2023 ACM Conference on Information Technology for Social Good', knowledge_types=['Venue'])), Triple(entity_subject=Knowledge(uid='R734575', text='Collaborative Scenario Builder: A VR Co-Design Tool for Medical First Responders', knowledge_types=['Paper']), predicate='publication year', entity_object=Knowledge(uid='L1271986', text='2023', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734575', text='Collaborative Scenario Builder: A VR Co-Design Tool for Medical First Responders', knowledge_types=['Paper']), predicate='publication month', entity_object=Knowledge(uid='L1271985', text='9', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734575', text='Collaborative Scenario Builder: A VR Co-Design Tool for Medical First Responders', knowledge_types=['Paper']), predicate='research field', entity_object=Knowledge(uid='R659055', text='Software Architecture and Design', knowledge_types=['ResearchField'])), Triple(entity_subject=Knowledge(uid='R734575', text='Collaborative Scenario Builder: A VR Co-Design Tool for Medical First Responders', knowledge_types=['Paper']), predicate='authors', entity_object=Knowledge(uid='R734576', text='authors list', knowledge_types=['List'])), Triple(entity_subject=Knowledge(uid='R734576', text='authors list', knowledge_types=['List']), predicate='has list element', entity_object=Knowledge(uid='L1271984', text='Katja Gallhuber', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734576', text='authors list', knowledge_types=['List']), predicate='has list element', entity_object=Knowledge(uid='L1271983', text='Daniele Pretolesi', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734576', text='authors list', knowledge_types=['List']), predicate='has list element', entity_object=Knowledge(uid='L1271982', text='Quynh Nguyen', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734575', text='Collaborative Scenario Builder: A VR Co-Design Tool for Medical First Responders', knowledge_types=['Paper']), predicate='doi', entity_object=Knowledge(uid='L1271981', text='10.1145/3582515.3609553', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R725100', text='virtual reality', knowledge_types=['External']), predicate='description', entity_object=Knowledge(uid='L1263493', text='computer-simulated environment simulating physical presence in real or imagined worlds', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R725100', text='virtual reality', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1263492', text='https://www.wikidata.org/entity/Q170519', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='wikidata:Q40', text='Austria', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1049483', text='https://www.wikidata.org/entity/Q40', knowledge_types=[]))])
    
    filter = GraphPathFilter()
    paths = PathBuilder(subgraph=subgraph).build_all_paths(
        current=Knowledge(
            uid="R734575",
            text="Collaborative Scenario Builder: A VR Co-Design Tool for Medical First Responders",
            knowledge_types=["Paper"]
        ),
        include_tails=True
    )
    
    new_subgraph = filter.get_subgraph_from_paths(paths=paths)
    
    assert len(subgraph) == len(new_subgraph)
    
    subgraph = Subgraph(root=[Triple(entity_subject=Knowledge(uid='R196145', text='training', knowledge_types=['Method']), predicate='Wikidata ID', entity_object=Knowledge(uid='L1319041', text='https://www.wikidata.org/wiki/Q918385', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R196145', text='training', knowledge_types=['Method']), predicate='Source', entity_object=Knowledge(uid='L1318833', text='literature review', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='doi', entity_object=Knowledge(uid='L1272146', text='10.48366/R734629', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='authors', entity_object=Knowledge(uid='R734630', text='authors', knowledge_types=['List'])), Triple(entity_subject=Knowledge(uid='R734630', text='authors', knowledge_types=['List']), predicate='has list element', entity_object=Knowledge(uid='R689239', text='Taras CHERNA', knowledge_types=['Author'])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='has subject', entity_object=Knowledge(uid='R659055', text='Software Architecture and Design', knowledge_types=['ResearchField'])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='description', entity_object=Knowledge(uid='L1272145', text='The term “first responder” refers to those individuals who in the early stages of an incident are responsible for the protection and preservation of life, property, evidence, and the environment, including emergency response providers as defined in by Homeland Security Act of 2002 (6 U.S.C. § 101), as well as emergency management, public health, clinical care, public works, and other skilled support personnel (such as equipment operators) that provide immediate support services during prevention, response, and recovery operations [Herrington, A.; Tacy, J. Crossing the Power Line: Using Virtual Simulation to Prepare the First Responders of Utility Linemen. Informatics 2020, 7, 26. https://doi.org/10.3390/informatics7030026].', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='compare contribution', entity_object=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution'])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='compare contribution', entity_object=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution'])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='compare contribution', entity_object=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution'])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='compare contribution', entity_object=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution'])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='compare contribution', entity_object=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution'])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='compare contribution', entity_object=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution'])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='compare contribution', entity_object=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution'])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='compare contribution', entity_object=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution'])), Triple(entity_subject=Knowledge(uid='R734629', text='What is the VR implementation in first responders training', knowledge_types=['LatestVersion', 'ComparisonPublished']), predicate='compare contribution', entity_object=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution'])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='Year', entity_object=Knowledge(uid='L1272142', text='2021', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='Year', entity_object=Knowledge(uid='L1272141', text='2021', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='Year', entity_object=Knowledge(uid='L1272140', text='2020', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='Year', entity_object=Knowledge(uid='L1272139', text='2022', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='Year', entity_object=Knowledge(uid='L1272138', text='2022', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='Year', entity_object=Knowledge(uid='L1272137', text='2023', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='Year', entity_object=Knowledge(uid='L1272136', text='2024', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='Year', entity_object=Knowledge(uid='L1272135', text='2024', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='Year', entity_object=Knowledge(uid='L1272134', text='2024', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272133', text='virtual reality-based system designed for\nfirefighters training\n', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272132', text='formal frst responder training course.', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272131', text='Virtual Reality Training Simulation', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272130', text='Virtual disaster environments', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272129', text='Valve Index controllers', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='R734623', text='Vive Pro kit', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='R734622', text='SHOTPROS', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272125', text='\n', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272122', text='Collaborative Scenario Builder', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272121', text='TraumaVR Creation System', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272120', text='scenario of a forensic strategy meeting', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272119', text='VR framework that enables the exploration of virtual environments on a standalone, low-cost immersive head-mounted display.', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR technology', entity_object=Knowledge(uid='L1272118', text='VR training scenarios for first responders.', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='Aim', entity_object=Knowledge(uid='L1272117', text='develop a training framework and a corresponding VR system concerned with improving the performance of decision-making and acting in high-stress and high-risk situations.', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='Aim', entity_object=Knowledge(uid='L1272116', text='explore the use of a VR-based mock-up tool (VRMT) to support a TP in the design and validation of a training experience', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='Aim', entity_object=Knowledge(uid='L1272115', text='present the a hardware platform that supports immersive training of frst responder units’ on-site squad leaders.', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='Aim', entity_object=Knowledge(uid='L1272114', text='present a simulation-based firefighter training for an earthquake scenario', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='Aim', entity_object=Knowledge(uid='L1272113', text='explore the efectiveness of VR technology and passive haptic interfaces when applied in the context of a formal training course for frst responders.', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='Aim', entity_object=Knowledge(uid='L1272112', text='provide such a co-design tool for the specific context of VR scenario development.', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='Aim', entity_object=Knowledge(uid='L1272111', text='describes the outcome of an intensive outpatient program (IOP), initially developed for military trauma, as applied to the treatment of first responders with PTSD.', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='Aim', entity_object=Knowledge(uid='L1272110', text='to provide an integrative documentation tool to enhance the decision-making processes in the early stages of the investigation.', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='Aim', entity_object=Knowledge(uid='L1272109', text='present the development and evaluation of the co-design method CoLEBricks which uses building blocks for the co-creation of VR training scenarios for first responders.', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR scenes used/developed', entity_object=Knowledge(uid='L1272108', text='false', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR scenes used/developed', entity_object=Knowledge(uid='L1272107', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR scenes used/developed', entity_object=Knowledge(uid='L1272106', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR scenes used/developed', entity_object=Knowledge(uid='L1272105', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR scenes used/developed', entity_object=Knowledge(uid='L1272104', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR scenes used/developed', entity_object=Knowledge(uid='L1272103', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR scenes used/developed', entity_object=Knowledge(uid='L1272102', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR scenes used/developed', entity_object=Knowledge(uid='L1272101', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='VR scenes used/developed', entity_object=Knowledge(uid='L1272100', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='research problem', entity_object=Knowledge(uid='R734620', text='What is the VR implementation in first responders training', knowledge_types=['Problem'])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='research problem', entity_object=Knowledge(uid='R734620', text='What is the VR implementation in first responders training', knowledge_types=['Problem'])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='research problem', entity_object=Knowledge(uid='R734620', text='What is the VR implementation in first responders training', knowledge_types=['Problem'])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='research problem', entity_object=Knowledge(uid='R734620', text='What is the VR implementation in first responders training', knowledge_types=['Problem'])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='research problem', entity_object=Knowledge(uid='R734620', text='What is the VR implementation in first responders training', knowledge_types=['Problem'])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='research problem', entity_object=Knowledge(uid='R734620', text='What is the VR implementation in first responders training', knowledge_types=['Problem'])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='research problem', entity_object=Knowledge(uid='R734620', text='What is the VR implementation in first responders training', knowledge_types=['Problem'])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='research problem', entity_object=Knowledge(uid='R734620', text='What is the VR implementation in first responders training', knowledge_types=['Problem'])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='research problem', entity_object=Knowledge(uid='R734620', text='What is the VR implementation in first responders training', knowledge_types=['Problem'])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734619', text='co-creation', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734619', text='co-creation', knowledge_types=['External']), predicate='description', entity_object=Knowledge(uid='L1272099', text='product or service design process in which input from consumers plays a central role', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734619', text='co-creation', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1272098', text='https://www.wikidata.org/entity/Q2270945', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272097', text='Stress cue interaction', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272096', text='Stress cues', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272095', text='High stress', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272094', text='Police training', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272093', text='Training experience', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734618', text='Forest frefghting', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R725100', text='virtual reality', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734614', text='first responder', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272092', text='experiential courses', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272091', text='dramaturgy prototyping', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R725100', text='virtual reality', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272090', text='mock-up tool', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272089', text='training design', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='empty', text='Value not reported in paper', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='empty', text='Value not reported in paper', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272088', text='Fire simulation', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734618', text='Forest frefghting', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734614', text='first responder', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272087', text='Video-based training', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734617', text='Passive haptics', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R725100', text='virtual reality', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734607', text='medical first responders', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272086', text='Virtual Simulation Training', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734616', text='co-design', knowledge_types=['External']), predicate='description', entity_object=Knowledge(uid='L1272085', text='approach to design attempting to actively involve all stakeholders', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734616', text='co-design', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734616', text='co-design', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1272084', text='https://www.wikidata.org/entity/Q16972712', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R725100', text='virtual reality', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='wikidata:Q3839081', text='disaster', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='Has participant', entity_object=Knowledge(uid='R734615', text='firefifghters with PTSD', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R602200', text='depression', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R725100', text='virtual reality', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734614', text='first responder', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734614', text='first responder', knowledge_types=['External']), predicate='description', entity_object=Knowledge(uid='L1272083', text='employee of an emergency service', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734614', text='first responder', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1272082', text='https://www.wikidata.org/entity/Q19693316', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='wikidata:Q154430', text='anxiety', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272081', text='posttraumatic stress disorder', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R196145', text='training', knowledge_types=['Method'])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R149806', text='decision making', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272080', text='Reconstruction ', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272079', text='Scene investigation', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R702639', text='fire', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734613', text='forensic science', knowledge_types=['External']), predicate='description', entity_object=Knowledge(uid='L1272078', text='application of science to criminal and civil laws', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734613', text='forensic science', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734613', text='forensic science', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1272077', text='https://www.wikidata.org/entity/Q495304', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='R734612', text='VR scenario', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272076', text='participatory design', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272075', text='co-creation', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='keywords', entity_object=Knowledge(uid='L1272074', text='co-design', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='Has participant', entity_object=Knowledge(uid='R734611', text='medicians', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='Has participant', entity_object=Knowledge(uid='R734610', text='policemen', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='Has participant', entity_object=Knowledge(uid='R734606', text='firefighter', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='Has participant', entity_object=Knowledge(uid='R734606', text='firefighter', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='Has participant', entity_object=Knowledge(uid='L1272073', text='policeman', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='Has participant', entity_object=Knowledge(uid='L1272072', text='trainers', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='Has participant', entity_object=Knowledge(uid='L1272071', text='fire brigades members', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='Has participant', entity_object=Knowledge(uid='L1272070', text='first responders and trainers', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='has female participants', entity_object=Knowledge(uid='empty', text='Value not reported in paper', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='has female participants', entity_object=Knowledge(uid='empty', text='Value not reported in paper', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='has female participants', entity_object=Knowledge(uid='L1272068', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='has female participants', entity_object=Knowledge(uid='L1272067', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='has female participants', entity_object=Knowledge(uid='L1272066', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='has female participants', entity_object=Knowledge(uid='L1272065', text='false', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='has female participants', entity_object=Knowledge(uid='L1272064', text='false', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='has female participants', entity_object=Knowledge(uid='L1272063', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='has female participants', entity_object=Knowledge(uid='L1272061', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='First Responders` training', entity_object=Knowledge(uid='L1272060', text='false', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='First Responders` training', entity_object=Knowledge(uid='L1272059', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='First Responders` training', entity_object=Knowledge(uid='L1272058', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='First Responders` training', entity_object=Knowledge(uid='L1272057', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='First Responders` training', entity_object=Knowledge(uid='L1272056', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='First Responders` training', entity_object=Knowledge(uid='L1272055', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='First Responders` training', entity_object=Knowledge(uid='L1272054', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='First Responders` training', entity_object=Knowledge(uid='L1272053', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='First Responders` training', entity_object=Knowledge(uid='L1272052', text='true', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='First responders', entity_object=Knowledge(uid='R734604', text='Police', knowledge_types=['DCLocation', 'External'])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='First responders', entity_object=Knowledge(uid='R734606', text='firefighter', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='First responders', entity_object=Knowledge(uid='R734609', text='Civil Protection trainees', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='First responders', entity_object=Knowledge(uid='R734606', text='firefighter', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='First responders', entity_object=Knowledge(uid='R734608', text='firefighters rescue unit', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='First responders', entity_object=Knowledge(uid='R734607', text='medical first responders', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734606', text='firefighter', knowledge_types=['External']), predicate='description', entity_object=Knowledge(uid='L1272051', text='rescuer trained to extinguish hazardous fires', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='First responders', entity_object=Knowledge(uid='R734606', text='firefighter', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734606', text='firefighter', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1272050', text='https://www.wikidata.org/entity/Q107711', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='First responders', entity_object=Knowledge(uid='R734604', text='Police', knowledge_types=['DCLocation', 'External'])), Triple(entity_subject=Knowledge(uid='R734604', text='Police', knowledge_types=['DCLocation', 'External']), predicate='same as', entity_object=Knowledge(uid='L1272049', text='https://sws.geonames.org/3192834/', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='First responders', entity_object=Knowledge(uid='R734603', text='Police', knowledge_types=['DCLocation', 'External'])), Triple(entity_subject=Knowledge(uid='R734603', text='Police', knowledge_types=['DCLocation', 'External']), predicate='same as', entity_object=Knowledge(uid='L1272048', text='https://sws.geonames.org/3341064/', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q38', text='Italy', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q38', text='Italy', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q40', text='Austria', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q40', text='Austria', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q40', text='Austria', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q38', text='Italy', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q30', text='United States of America', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q145', text='United Kingdom', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q213', text='Czech Republic', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q31', text='Belgium', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='Authors: Country', entity_object=Knowledge(uid='wikidata:Q40', text='Austria', knowledge_types=['External'])), Triple(entity_subject=Knowledge(uid='R734595', text='Contribution 1', knowledge_types=['Contribution']), predicate='# participants', entity_object=Knowledge(uid='L1272047', text='60', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734592', text='Contribution 1', knowledge_types=['Contribution']), predicate='# participants', entity_object=Knowledge(uid='L1272046', text='2', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734588', text='Contribution 1', knowledge_types=['Contribution']), predicate='# participants', entity_object=Knowledge(uid='L1272045', text='41', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734584', text='Contribution 1', knowledge_types=['Contribution']), predicate='# participants', entity_object=Knowledge(uid='L1272044', text='20', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734581', text='Contribution 1', knowledge_types=['Contribution']), predicate='# participants', entity_object=Knowledge(uid='L1272043', text='45', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734578', text='Contribution 1', knowledge_types=['Contribution']), predicate='# participants', entity_object=Knowledge(uid='L1272042', text='41', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734574', text='Contribution 1', knowledge_types=['Contribution']), predicate='# participants', entity_object=Knowledge(uid='L1272041', text='14', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734570', text='Contribution 1', knowledge_types=['Contribution']), predicate='# participants', entity_object=Knowledge(uid='L1272040', text='15', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R734566', text='Contribution 1', knowledge_types=['Contribution']), predicate='# participants', entity_object=Knowledge(uid='L1272039', text='26', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R725100', text='virtual reality', knowledge_types=['External']), predicate='description', entity_object=Knowledge(uid='L1263493', text='computer-simulated environment simulating physical presence in real or imagined worlds', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R725100', text='virtual reality', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1263492', text='https://www.wikidata.org/entity/Q170519', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R702639', text='fire', knowledge_types=['External']), predicate='description', entity_object=Knowledge(uid='L1237623', text='rapid oxidation of a material; phenomenon that emits light and heat', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R702639', text='fire', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1237622', text='https://www.wikidata.org/entity/Q3196', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='wikidata:Q3839081', text='disaster', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1234209', text='https://www.wikidata.org/entity/Q3839081', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='R689239', text='Taras CHERNA', knowledge_types=['Author']), predicate='Has ORCID', entity_object=Knowledge(uid='L1201145', text='0009-0005-9624-7992', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='wikidata:Q154430', text='anxiety', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1073455', text='https://www.wikidata.org/entity/Q154430', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='wikidata:Q145', text='United Kingdom', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1068248', text='https://www.wikidata.org/entity/Q145', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='wikidata:Q213', text='Czech Republic', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1060900', text='https://www.wikidata.org/entity/Q213', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='wikidata:Q40', text='Austria', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L1049483', text='https://www.wikidata.org/entity/Q40', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='wikidata:Q31', text='Belgium', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L615547', text='https://www.wikidata.org/entity/Q31', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='wikidata:Q38', text='Italy', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L542239', text='https://www.wikidata.org/entity/Q38', knowledge_types=[])), Triple(entity_subject=Knowledge(uid='wikidata:Q30', text='United States of America', knowledge_types=['External']), predicate='same as', entity_object=Knowledge(uid='L528364', text='https://www.wikidata.org/entity/Q30', knowledge_types=[]))])
    
    paths = PathBuilder(subgraph=subgraph).build_all_paths(
        current=Knowledge(
            uid='R734629', 
            text='What is the VR implementation in first responders training',
            knowledge_types=["Paper"]
        ),
        include_tails=True
    )
    new_subgraph = filter.get_subgraph_from_paths(paths=paths)
    assert len(subgraph) == len(new_subgraph)


def test_build_all_paths(subgraph):
    current = subgraph[0].entity_subject
    expected_paths = [
        [subgraph[0], subgraph[1], subgraph[2]],
        [subgraph[0], subgraph[1], subgraph[3]]
    ]
    path_builder = PathBuilder(subgraph=subgraph)
    paths = path_builder.build_all_paths(current, include_tails=False)
    assert paths == expected_paths


def test_build_all_paths_and_get_subgraph(subgraph):
    path_builder = PathBuilder(subgraph=subgraph)
    path_filter = GraphPathFilter()
    current = subgraph[0].entity_subject
    paths = path_builder.build_all_paths(current, include_tails=True)
    returned_subgraph = path_filter.get_subgraph_from_paths(paths)
    assert set(subgraph) == set(returned_subgraph)

def test_build_all_paths_simple_linear():
        """Test build_all_paths with a simple linear path."""
        entity_1 = Knowledge(uid="1", text="1")
        entity_2 = Knowledge(uid="2", text="2")
        entity_3 = Knowledge(uid="3", text="3")
        
        relation_1 = Triple(entity_subject=entity_1, entity_object=entity_2, predicate="rel1")
        relation_2 = Triple(entity_subject=entity_2, entity_object=entity_3, predicate="rel2")
        
        subgraph = Subgraph([relation_1, relation_2])
        path_builder = PathBuilder(subgraph=subgraph)
        paths = path_builder.build_all_paths(entity_1, include_tails=True)

        expected = [[relation_1, relation_2]]
        assert paths == expected

def test_build_all_paths_branching():
    """Test build_all_paths with branching paths."""
    
    entity_1 = Knowledge(uid="1", text="1")
    entity_2 = Knowledge(uid="2", text="2")
    entity_3 = Knowledge(uid="3", text="3")
    entity_4 = Knowledge(uid="4", text="4")
    
    relation_1 = Triple(entity_subject=entity_1, entity_object=entity_2, predicate="rel1")
    relation_2 = Triple(entity_subject=entity_2, entity_object=entity_3, predicate="rel2")
    relation_3 = Triple(entity_subject=entity_2, entity_object=entity_4, predicate="rel3")
    
    subgraph = Subgraph([relation_1, relation_2, relation_3])
    path_builder = PathBuilder(subgraph=subgraph)
    paths = path_builder.build_all_paths(entity_1, include_tails=True, include_against_direction=True)

    expected = [
        [relation_1, relation_2],
        [relation_1, relation_3]
    ]
    assert sorted(paths) == sorted(expected)

def test_build_all_paths_with_cycle():
    """Test build_all_paths with a cyclic graph."""
    entity_1 = Knowledge(uid="1", text="1")
    entity_2 = Knowledge(uid="2", text="2")
    entity_3 = Knowledge(uid="3", text="3")
    
    # Create a cycle: 1->2->3->1
    relation_1 = Triple(entity_subject=entity_1, entity_object=entity_2, predicate="rel1")
    relation_2 = Triple(entity_subject=entity_2, entity_object=entity_3, predicate="rel2")
    relation_3 = Triple(entity_subject=entity_3, entity_object=entity_1, predicate="rel3")

    subgraph = Subgraph([relation_1, relation_2, relation_3])
    path_builder = PathBuilder(subgraph=subgraph)
    paths = path_builder.build_all_paths(entity_1, include_tails=True)
    # This should not cause infinite recursion
    assert len(paths) > 0  # Should find at least one path
    assert all(len(path) <= 3 for path in paths)  # No path should be longer than 3 relations

def test_build_all_paths_complex_with_cycles():
    """Test build_all_paths with a complex graph containing multiple cycles."""
    entity_1 = Knowledge(uid="1", text="1")
    entity_2 = Knowledge(uid="2", text="2")
    entity_3 = Knowledge(uid="3", text="3")
    entity_4 = Knowledge(uid="4", text="4")
    
    # Create multiple cycles
    rel1 = Triple(entity_subject=entity_1, entity_object=entity_2, predicate="rel1")
    rel2 = Triple(entity_subject=entity_2, entity_object=entity_3, predicate="rel2")
    rel3 = Triple(entity_subject=entity_3, entity_object=entity_1, predicate="rel3")  # Cycle 1
    rel4 = Triple(entity_subject=entity_2, entity_object=entity_4, predicate="rel4")
    rel5 = Triple(entity_subject=entity_4, entity_object=entity_2, predicate="rel5")  # Cycle 2

    subgraph = Subgraph([rel1, rel2, rel3, rel4, rel5])

    path_builder = PathBuilder(subgraph=subgraph)
    paths = path_builder.build_all_paths(entity_1, include_tails=True)

    assert len(paths) > 0
    # Each path should have reasonable length to avoid infinite cycles
    assert all(len(path) <= 5 for path in paths)
    


if __name__ == "__main__":
    import sys
    pytest.main([sys.argv[0], "-v"])


